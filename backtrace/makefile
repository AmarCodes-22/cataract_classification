.PHONY: run setup run_backtrace run_difference run_mask_refinement clean

API_URL ?= 
CSV_PATH ?= 
PAYLOAD_FILE ?= 
BACKTRACE_DIR ?= 
WITHOUT_BACKTRACE_DIR ?=
AI_DASH_DIR ?= 
MANUAL_DIR ?=
PASS_IMAGES_DIR ?= 
FAIL_IMAGES_DIR ?= 
DIFFERENCE_PASS_DIR ?=
DIFFERENCE_FAIL_DIR ?= 
MASK_PASS_DIR ?= 
MASK_FAIL_DIR ?= 
MODEL_PATH ?= 

setup:
	@echo "Creating necessary directories..."
	@mkdir -p $(BACKTRACE_DIR) $(WITHOUT_BACKTRACE_DIR) $(AI_DASH_DIR) $(MANUAL_DIR) $(PASS_IMAGES_DIR) $(FAIL_IMAGES_DIR) $(DIFFERENCE_PASS_DIR) $(DIFFERENCE_FAIL_DIR) $(MASK_PASS_DIR) $(MASK_FAIL_DIR)

run_bulk:
	export API_URL=$(API_URL) CSV_PATH=$(CSV_PATH) PAYLOAD_FILE=$(PAYLOAD_FILE) BACKTRACE_DIR=$(BACKTRACE_DIR) WITHOUT_BACKTRACE_DIR=$(WITHOUT_BACKTRACE_DIR) AI_DASH_DIR=$(AI_DASH_DIR) MANUAL_DIR=$(MANUAL_DIR) PASS_IMAGES_DIR=$(PASS_IMAGES_DIR) FAIL_IMAGES_DIR=$(FAIL_IMAGES_DIR); \
	python bulk/bulk.py $(API_URL) $(CSV_PATH) $(PAYLOAD_FILE) --backtrace_dir $(BACKTRACE_DIR) --without_backtrace_dir $(WITHOUT_BACKTRACE_DIR) --ai_dash_dir $(AI_DASH_DIR) --manual_dir $(MANUAL_DIR) --pass_images_dir $(PASS_IMAGES_DIR) --fail_images_dir $(FAIL_IMAGES_DIR)

run_backtrace: run_difference clean run_mask_refinement

run_difference:
	export BACKTRACE_DIR=$(BACKTRACE_DIR) WITHOUT_BACKTRACE_DIR=$(WITHOUT_BACKTRACE_DIR) AI_DASH_DIR=$(AI_DASH_DIR) MANUAL_DIR=$(MANUAL_DIR) DIFFERENCE_PASS_DIR=$(DIFFERENCE_PASS_DIR) DIFFERENCE_FAIL_DIR=$(DIFFERENCE_FAIL_DIR); \
	python difference/difference.py

run_mask_refinement:
	export DIFFERENCE_PASS_DIR=$(DIFFERENCE_PASS_DIR) DIFFERENCE_FAIL_DIR=$(DIFFERENCE_FAIL_DIR) MASK_PASS_DIR=$(MASK_PASS_DIR) MASK_FAIL_DIR=$(MASK_FAIL_DIR) MODEL_PATH=$(MODEL_PATH); \
	python mask_refinement/mask_refinement.py $(DIFFERENCE_PASS_DIR) $(DIFFERENCE_FAIL_DIR) $(MODEL_PATH) $(MASK_PASS_DIR) $(MASK_FAIL_DIR)

clean:
	@echo "Cleaning up..."
	@rm -rf $(BACKTRACE_DIR) $(WITHOUT_BACKTRACE_DIR) $(AI_DASH_DIR) $(MANUAL_DIR)